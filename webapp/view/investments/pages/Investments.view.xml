<mvc:View controllerName="com.invertions.sapfiorimodinv.controller.investments.Investments"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:l="sap.ui.layout" xmlns:f="sap.ui.layout.form" xmlns:core="sap.ui.core"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.data="sap.viz.ui5.data"
    xmlns:mc="sap.suite.ui.microchart" xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
    displayBlock="true">

    <Page id="investmentsPage" title="{i18n>investmentsPageTitle}" showHeader="true">
        <headerContent>
            <core:Fragment fragmentName="com.invertions.sapfiorimodinv.view.investments.fragments.SymbolSelector" type="XML"/>

        <ToolbarSpacer id="_IDGenToolbarSpacer2"/>
        <Text id="_IDGenText8" text="{= 'Balance: $' + ${strategyAnalysisModel>/balance}}"
            class="customSuccessText sapUiSmallMarginBegin"/>
 
        </headerContent>
        <content>
            <VBox id="_IDGenVBox" class="sapUiResponsivePadding">            
                <IconTabBar id="_IDGenIconTabBar" expandable="false" selectedKey="{viewModel>/selectedTab}" select=".onTabSelect">
                    <items>
                        <!-- TABLA -->
                        <IconTabFilter id="_IDGenIconTabFilter" text="Table" key="table">
                            <FlexBox id="_IDGenFlexBox" renderType="Bare" alignItems="Stretch" justifyContent="Start" width="100%">
                                <!-- Tabla -->
                                <VBox id="_IDGenVBox1" fitContainer="true" width="100%" class="sapUiSmallMarginEnd">
                                <layoutData>
                                    <FlexItemData id="_IDGenFlexItemData" growFactor="1"/>
                                </layoutData>
                                    <ScrollContainer id="_IDGenScrollContainer" height="60%" vertical="true" horizontal="false" width="100%">
                                        <Table id="_IDGenTable2" items="{strategyResultModel>/chart_data}" width="100%" growing="false">
                                            <columns>
                                                <Column id="_IDGenColumn6"><Text id="_IDGenText9" text="Date"/></Column>
                                                <Column id="_IDGenColumn7"><Text id="_IDGenText10" text="Open"/></Column>
                                                <Column id="_IDGenColumn8"><Text id="_IDGenText11" text="High"/></Column>
                                                <Column id="_IDGenColumn9"><Text id="_IDGenText12" text="Low"/></Column>
                                                <Column id="_IDGenColumn10"><Text id="_IDGenText13" text="Close"/></Column>
                                                <Column id="_IDGenColumn11"><Text id="_IDGenText14" text="Volume"/></Column>
                                                <Column id="_IDGenColumn12"><Text id="_IDGenText15" text="Indicators"/></Column>
                                                <Column id="_IDGenColumn13"><Text id="_IDGenText16" text="Signals"/></Column>
                                                <Column id="_IDGenColumn14"><Text id="_IDGenText17" text="Rules"/></Column> <!-- Criterios -->
                                                <Column id="_IDGenColumn15"><Text id="_IDGenText18" text="Shares"/></Column> <!-- Acciones -->
                                            </columns>
                                            <items>
                                                <ColumnListItem id="_IDGenColumnListItem2">
                                                    <Text id="_IDGenText19" text="{strategyResultModel>DATE}"/>
                                                    <Text id="_IDGenText20" text="{strategyResultModel>OPEN}"/>
                                                    <Text id="_IDGenText21" text="{strategyResultModel>HIGH}"/>
                                                    <Text id="_IDGenText22" text="{strategyResultModel>LOW}"/>
                                                    <Text id="_IDGenText23" text="{strategyResultModel>CLOSE}"/>
                                                    <Text id="_IDGenText24" text="{strategyResultModel>VOLUME}"/>
                                                    <Text id="_IDGenText25" text="{strategyResultModel>INDICATORS}"/>
                                                    <Text id="_IDGenText26" text="{strategyResultModel>SIGNALS}"/>
                                                    <Text id="_IDGenText27" text="{strategyResultModel>RULES}"/>
                                                    <Text id="_IDGenText28" text="{strategyResultModel>SHARES}"/>
                                                </ColumnListItem>
                                            </items>
                                        </Table>
                                    </ScrollContainer>
                                </VBox>
                                <!-- Panel lateral solo análisis -->
                                <VBox id="_IDGenVBox2" width="300px" class="sapUiSmallMarginBottom">
                                    <core:Fragment id="strategyAnalysisPanelTable" fragmentName="com.invertions.sapfiorimodinv.view.investments.fragments.StrategyAnalysisPanel" type="XML" />
                                </VBox>
                            </FlexBox>
                        </IconTabFilter>
                        <!-- GRÁFICA -->
                        <IconTabFilter id="_IDGenIconTabFilter1" text="Chart" key="chart">
                            <FlexBox id="_IDGenFlexBox1" renderType="Bare" alignItems="Stretch" justifyContent="Start" height="auto" width="100%">
                                <!-- Gráfica -->
                                <VBox id="_IDGenVBox3" fitContainer="true" height="100%" width="100%" class="sapUiSmallMarginEnd">
                                <layoutData>
                                    <FlexItemData id="_IDGenFlexItemData1" growFactor="1"/>
                                </layoutData>
                                    <Panel id="_IDGenPanel" headerText="Gráfico de Precios" width="100%" class="sapUiSizeCompact" expandable="false" expanded="false">
                                        <headerToolbar>
                                            <OverflowToolbar id="_IDGenOverflowToolbar">
                                                <Title id="_IDGenTitle3" text="Gráfico de Precios"/>
                                                <ToolbarSpacer id="_IDGenToolbarSpacer3"/>
                                                <Button id="_IDGenButton9" icon="sap-icon://refresh" tooltip="Actualizar datos" press=".onRefreshChart"/>
                                            </OverflowToolbar>
                                        </headerToolbar>
                                        <content>
                                            <viz:VizFrame
                                                id="idVizFrame"
                                                vizType="timeseries_line" width="auto"
                                                uiConfig="{applicationSet:'fiori'}"
                                                busy="{= !${strategyResultModel>/chart_data} || ${strategyResultModel>/chart_data}.length === 0 }"
                                                visible="true"
                                                busyIndicatorDelay="0"
                                                selectData=".onDataPointSelect">
                                                <viz:dataset>
                                                    <viz.data:FlattenedDataset id="_IDGenFlattenedDataset" data="{strategyResultModel>/chart_data}">
                                                        <viz.data:dimensions>
                                                            <viz.data:DimensionDefinition id="_IDGenDimensionDefinition"
                                                                name="Fecha"
                                                                value="{strategyResultModel>DATE}"
                                                                dataType="date"/>
                                                        </viz.data:dimensions>
                                                        <viz.data:measures>
                                                            <viz.data:MeasureDefinition id="_IDGenMeasureDefinition"
                                                                name="PrecioCierre" value="{strategyResultModel>CLOSE}"/>
                                                            <viz.data:MeasureDefinition id="_IDGenMeasureDefinition1"
                                                                name="ShortMA" value="{strategyResultModel>SHORT_MA}"/>
                                                            <viz.data:MeasureDefinition id="_IDGenMeasureDefinition2"
                                                                name="LongMA" value="{strategyResultModel>LONG_MA}"/>
                                                        </viz.data:measures>
                                                    </viz.data:FlattenedDataset>
                                                </viz:dataset>
                                                <viz:feeds>
                                                    <viz.feeds:FeedItem id="_IDGenFeedItem"
                                                        uid="timeAxis" type="Dimension"
                                                        values="Fecha"/>
                                                    <viz.feeds:FeedItem id="_IDGenFeedItem1"
                                                        uid="valueAxis" type="Measure"
                                                        values="PrecioCierre"/>
                                                    <viz.feeds:FeedItem id="_IDGenFeedItem2"
                                                        uid="valueAxis" type="Measure"
                                                        values="ShortMA"/> 
                                                    <viz.feeds:FeedItem id="_IDGenFeedItem3"
                                                        uid="valueAxis" type="Measure"
                                                        values="LongMA"/> 
                                                </viz:feeds>
                                            </viz:VizFrame>
                                            
                                        </content>
                                    </Panel>
                                </VBox>
                                <!-- Panel lateral análisis y resultados -->
                                <VBox id="_IDGenVBox9" width="300px" class="sapUiSmallMarginBottom">
                                    <core:Fragment id="strategyAnalysisPanelChart" fragmentName="com.invertions.sapfiorimodinv.view.investments.fragments.StrategyAnalysisPanel" type="XML" />
                                </VBox>
                            </FlexBox>
                            <VBox id="_IDGenVBox10" width="auto">
                        <core:Fragment fragmentName="com.invertions.sapfiorimodinv.view.investments.fragments.StrategyResultPanel" type="XML" />
                        </VBox>
                        </IconTabFilter>
                    </items>
                </IconTabBar>
            </VBox>
        </content>
    </Page>
</mvc:View>